 * ------------------------------------------------------------------------------------ ;
 *  TITLE:  IQI Diagnosis Clinical Classifications Software Redefined (DXCCSR) Code --- ;
 *                                                                                  --- ;
 *  DESCRIPTION: Creates DXCCSR variables based on diagnoses present on admission   --- ;
 *                                                                                  --- ;
 *  VERSION: SAS QI v2023                                                           --- ;
 *  RELEASE DATE: AUGUST 2023                                                       --- ;
 * ------------------------------------------------------------------------------------ ;

%MACRO CREATE_CCSR;

%LET d_DXCCSR_list= 
d_DXCCSR_BLD001_123 d_DXCCSR_BLD003_123 d_DXCCSR_BLD004_123 d_DXCCSR_BLD006_123 d_DXCCSR_BLD007_123 d_DXCCSR_BLD008_123
d_DXCCSR_CIR001_123 d_DXCCSR_CIR003_123 d_DXCCSR_CIR004_123 d_DXCCSR_CIR005_123 d_DXCCSR_CIR006_123 d_DXCCSR_CIR007_123
d_DXCCSR_CIR008_123 d_DXCCSR_CIR009_123 d_DXCCSR_CIR011_123 d_DXCCSR_CIR013_123 d_DXCCSR_CIR014_123 d_DXCCSR_CIR015_123
d_DXCCSR_CIR016_123 d_DXCCSR_CIR017_123 d_DXCCSR_CIR018_123 d_DXCCSR_CIR019_123 d_DXCCSR_CIR020_123 d_DXCCSR_CIR021_123
d_DXCCSR_CIR023_123 d_DXCCSR_CIR024_123 d_DXCCSR_CIR025_123 d_DXCCSR_CIR026_123 d_DXCCSR_CIR027_123 d_DXCCSR_CIR028_123
d_DXCCSR_CIR029_123 d_DXCCSR_CIR030_123 d_DXCCSR_CIR031_123 d_DXCCSR_CIR032_123 d_DXCCSR_CIR033_123 d_DXCCSR_CIR034_123
d_DXCCSR_CIR036_123 d_DXCCSR_CIR039_123 d_DXCCSR_DEN001_123 d_DXCCSR_DEN003_123 d_DXCCSR_DIG001_123 d_DXCCSR_DIG004_123
d_DXCCSR_DIG005_123 d_DXCCSR_DIG006_123 d_DXCCSR_DIG007_123 d_DXCCSR_DIG008_123 d_DXCCSR_DIG010_123 d_DXCCSR_DIG012_123
d_DXCCSR_DIG013_123 d_DXCCSR_DIG014_123 d_DXCCSR_DIG016_123 d_DXCCSR_DIG018_123 d_DXCCSR_DIG019_123 d_DXCCSR_DIG020_123
d_DXCCSR_DIG021_123 d_DXCCSR_DIG022_123 d_DXCCSR_DIG024_123 d_DXCCSR_DIG025_123 d_DXCCSR_EAR004_123 d_DXCCSR_END001_123
d_DXCCSR_END002_123 d_DXCCSR_END003_123 d_DXCCSR_END005_123 d_DXCCSR_END007_123 d_DXCCSR_END008_123 d_DXCCSR_END009_123
d_DXCCSR_END010_123 d_DXCCSR_END011_123 d_DXCCSR_END013_123 d_DXCCSR_END015_123 d_DXCCSR_END016_123 d_DXCCSR_EXT017_123
d_DXCCSR_EYE003_123 d_DXCCSR_EYE006_123 d_DXCCSR_EYE010_123 d_DXCCSR_EYE012_123 d_DXCCSR_FAC009_123 d_DXCCSR_FAC014_123
d_DXCCSR_FAC022_123 d_DXCCSR_GEN001_123 d_DXCCSR_GEN002_123 d_DXCCSR_GEN003_123 d_DXCCSR_GEN004_123 d_DXCCSR_GEN005_123
d_DXCCSR_GEN006_123 d_DXCCSR_GEN007_123 d_DXCCSR_GEN008_123 d_DXCCSR_GEN009_123 d_DXCCSR_GEN012_123 d_DXCCSR_INF002_123
d_DXCCSR_INF003_123 d_DXCCSR_INF004_123 d_DXCCSR_INF007_123 d_DXCCSR_INF008_123 d_DXCCSR_INJ002_123 d_DXCCSR_INJ003_123
d_DXCCSR_INJ004_123 d_DXCCSR_INJ010_123 d_DXCCSR_INJ012_123 d_DXCCSR_INJ016_123 d_DXCCSR_INJ017_123 d_DXCCSR_INJ026_123
d_DXCCSR_INJ028_123 d_DXCCSR_INJ030_123 d_DXCCSR_INJ031_123 d_DXCCSR_INJ033_123 d_DXCCSR_INJ034_123 d_DXCCSR_INJ036_123
d_DXCCSR_INJ037_123 d_DXCCSR_MAL001_123 d_DXCCSR_MBD001_123 d_DXCCSR_MBD002_123 d_DXCCSR_MBD003_123 d_DXCCSR_MBD005_123
d_DXCCSR_MBD007_123 d_DXCCSR_MBD017_123 d_DXCCSR_MBD018_123 d_DXCCSR_MBD019_123 d_DXCCSR_MBD021_123 d_DXCCSR_MBD024_123
d_DXCCSR_MUS006_123 d_DXCCSR_MUS010_123 d_DXCCSR_MUS011_123 d_DXCCSR_MUS013_123 d_DXCCSR_MUS024_123 d_DXCCSR_MUS025_123
d_DXCCSR_MUS026_123 d_DXCCSR_MUS028_123 d_DXCCSR_MUS033_123 d_DXCCSR_MUS038_123 d_DXCCSR_NEO012_123 d_DXCCSR_NEO015_123
d_DXCCSR_NEO017_123 d_DXCCSR_NEO018_123 d_DXCCSR_NEO022_123 d_DXCCSR_NEO039_123 d_DXCCSR_NEO051_123 d_DXCCSR_NEO058_123
d_DXCCSR_NEO060_123 d_DXCCSR_NEO061_123 d_DXCCSR_NEO068_123 d_DXCCSR_NEO070_123 d_DXCCSR_NEO072_123 d_DXCCSR_NEO073_123
d_DXCCSR_NEO074_123 d_DXCCSR_NVS004_123 d_DXCCSR_NVS006_123 d_DXCCSR_NVS008_123 d_DXCCSR_NVS009_123 d_DXCCSR_NVS010_123
d_DXCCSR_NVS011_123 d_DXCCSR_NVS013_123 d_DXCCSR_NVS015_123 d_DXCCSR_NVS016_123 d_DXCCSR_NVS018_123 d_DXCCSR_NVS019_123
d_DXCCSR_NVS020_123 d_DXCCSR_RSP002_123 d_DXCCSR_RSP003_123 d_DXCCSR_RSP005_123 d_DXCCSR_RSP008_123 d_DXCCSR_RSP009_123
d_DXCCSR_RSP010_123 d_DXCCSR_RSP011_123 d_DXCCSR_RSP012_123 d_DXCCSR_RSP013_123 d_DXCCSR_RSP014_123 d_DXCCSR_RSP016_123
d_DXCCSR_SKN001_123 d_DXCCSR_SKN002_123 d_DXCCSR_SKN003_123 d_DXCCSR_SKN004_123 d_DXCCSR_SKN007_123 d_DXCCSR_SYM003_123
d_DXCCSR_SYM004_123 d_DXCCSR_SYM005_123 d_DXCCSR_SYM006_123 d_DXCCSR_SYM007_123 d_DXCCSR_SYM008_123 d_DXCCSR_SYM010_123
d_DXCCSR_SYM011_123 d_DXCCSR_SYM012_123 d_DXCCSR_SYM013_123 d_DXCCSR_SYM016_123 d_DXCCSR_SYM017_123 
;
%LET d_DXCCSR_cnt = 185;

%* Initialize CCSRs ;
%DO J = 1 %TO &d_DXCCSR_cnt.;
  %LET d_var = %SCAN(&d_DXCCSR_list., &J.);
  attrib &d_var. length = 3;
  &d_var. = 0;
%END;

%* Scan each DX ;
%* Count the DXCCSR if the DXCCSR diagnosis is present on admission or POA exempt;
do i = 1 to &NDX;
  if not missing(DX{i}) then do;
    attrib POA_yes length = 3 label = 'DX is POA or POA exempt';
    poa_yes=0;
    select(ICDVER) ;
      %DO ICDVER_ = 40 %TO 33 %BY -1;
         when (&ICDVER_.) do; 
           if (DXPOA{i} IN ('Y','W') AND put(DX{i},$poaxmpt_v&ICDVER_.fmt.)='0') OR (put(DX{i},$poaxmpt_v&ICDVER_.fmt.)='1') then POA_yes = 1;
         end; /* end when */
      %END;  
    end; /* end select */
    %DO J = 1 %TO &d_DXCCSR_cnt.;
      %LET d_var   = %SCAN(&d_DXCCSR_list., &J.);
      %LET CCSRVAL = %SCAN(&d_var.,3,"_");
      if put(DX{i},$&CCSRVAL.FMT.)='1' AND poa_yes then &d_var. = 1;
    %END;
  end; /* end if not missing DX */
end; /* end of do DX */

%MEND CREATE_CCSR;

%CREATE_CCSR;

